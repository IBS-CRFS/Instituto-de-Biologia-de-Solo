# Scripts and Phylogenetic Analyses

This folder contains the scripts, input data, and results from the phylogenetic analyses conducted for the *Troglobius* study (Collembola: Paronellidae), using sequences of the mitochondrial gene cytochrome oxidase subunit I (COI).

## Methodological Description

### Analysis Pipeline

Phylogenetic analyses followed an automated pipeline implemented in Python, comprising the following steps:

1. **Sequence compilation**: Concatenation of COI sequences from *Troglobius* and related Paronellidae taxa obtained from GenBank
2. **Codon-aware alignment**: Multiple alignment preserving reading frame using MACSE v2.07 (Ranwez et al. 2011)
3. **Alignment processing**: Cleaning of ambiguous characters and trimming to common overlapping region
4. **Partitioning**: Generation of partition schemes by codon position (1st, 2nd, and 3rd positions)
5. **Phylogenetic inference**: Maximum likelihood analysis with IQ-TREE 2, including model selection (ModelFinder), ultrafast bootstrap (UFBoot; 1,000 replicates), and SH-aLRT (1,000 replicates)

### Analysis Scripts

**run_pipeline_macse_iqtree.py**: Integrated pipeline that executes all phylogenetic analysis steps. Concatenates multiple FASTA files, performs codon-aware alignment with MACSE (genetic code 5 for invertebrate mitochondria), cleans and processes the alignment, generates partition scheme, and executes phylogenetic inference with IQ-TREE.

**run_macse_codon.py**: Modular script to execute only the MACSE alignment step, generating nucleotide and amino acid alignments.

**rodar_iqtree.py**: Script for phylogenetic inference from pre-existing alignments, with support for partitioned and non-partitioned analyses.

**gerar_particoes_codon.py**: Utility to generate partition files in NEXUS format from FASTA alignments, using the Biopython library.

**README_pipeline.md**: Detailed technical documentation of the pipeline, including parameters and usage examples.

## Input Data

**Paronellidae_sequences/**: Directory containing 54 individual FASTA files with COI sequences from Paronellidae species obtained from GenBank (accessions GQ374044-GQ374058, KJ716828, KM978343-KM978406, KY052898-KY052899, MG036988, MG318457, MK431896, MK510939-MK510940, MT357591-MT357826, MW193969, OM559919, OM593862, OM613812) and sequences generated by this study, including *Troglobius brasiliensis*.

**todas_sequencias.fasta**: Consolidated file containing all sequences used in the phylogenetic analysis (n=54 sequences).

## Results

### Alignments

**alinhamento_macse_atual.macse.nt.fasta**: Raw nucleotide alignment generated by MACSE.

**alinhamento_macse_atual.macse.aa.fasta**: Amino acid translation of the nucleotide alignment.

**alinhamento_macse_atual.macse.nt.clean.fasta**: Nucleotide alignment after replacement of frameshift characters (`!`) with gaps (`-`).

**alinhamento_macse_atual.macse.nt.clean.trimmed.fasta**: Final alignment after trimming to common conserved region, maintaining reading frame (multiples of 3 nucleotides). This file was used in phylogenetic analyses.

### Partition Schemes

**alinhamento_macse_atual.partitions.nex**: NEXUS file defining three partitions corresponding to codon positions (1st, 2nd, and 3rd).

**alinhamento_macse_atual.partitions.nex.best_scheme**: Optimized partition scheme selected by IQ-TREE's MERGE algorithm.

**alinhamento_macse_atual.partitions.nex.best_scheme.nex**: NEXUS format version of the optimized partition scheme.

**alinhamento_macse_atual.partitions.nex.best_model.nex**: Evolutionary models selected by ModelFinder for each partition.

### Phylogenetic Trees

**alinhamento_macse_atual.partitions.nex.treefile**: Maximum likelihood tree with UFBoot and SH-aLRT support values. This tree represents the main phylogenetic hypothesis of this study.

**alinhamento_macse_atual.partitions.nex.contree**: Extended majority-rule consensus tree based on bootstrap replicates.

**alinhamento_macse_atual.partitions.nex.bionj**: Initial tree generated by the BioNJ algorithm, used as starting point for maximum likelihood search.

**alinhamento_macse_atual.partitions.nex.splits.nex**: NEXUS file containing information about splits (bipartitions) and support.

### Diagnostic and Support Files

**alinhamento_macse_atual.partitions.nex.iqtree**: Complete log file of the IQ-TREE analysis, including information about selected models, estimated parameters, likelihood scores, and fit statistics.

**alinhamento_macse_atual.partitions.nex.mldist**: Maximum likelihood distance matrix between all taxa.

**alinhamento_macse_atual.partitions.nex.uniqueseq.phy**: Alignment in PHYLIP format containing only unique haplotypes, used internally by IQ-TREE for computational optimization.

## Reproducibility

Results can be reproduced by running the following command from this directory:

```bash
python run_pipeline_macse_iqtree.py \
  --macse-jar macse_v2.07.jar \
  --trim-common-overlap \
  --keep-terms 3 \
  --prefix ./alinhamento_macse_atual \
  todas_sequencias.fasta
```

### Software Dependencies

- Python 3.8+
- Java 8+ (for MACSE)
- MACSE v2.07 (Ranwez et al. 2011)
- IQ-TREE 2 (Minh et al. 2020)
- Biopython (for gerar_particoes_codon.py)

## References

Minh, B.Q., Schmidt, H.A., Chernomor, O., Schrempf, D., Woodhams, M.D., von Haeseler, A., Lanfear, R., 2020. IQ-TREE 2: New models and efficient methods for phylogenetic inference in the genomic era. Mol. Biol. Evol. 37, 1530â€“1534.

Ranwez, V., Harispe, S., Delsuc, F., Douzery, E.J.P., 2011. MACSE: Multiple Alignment of Coding SEquences accounting for frameshifts and stop codons. PLoS ONE 6, e22594.
